<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Using audience targeting | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Using audience targeting | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/pnpcore/blob/dev/docs/using-the-sdk/audience-targeting-intro.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="using-audience-targeting">Using audience targeting</h1>

<p>Audience targeting helps the most relevant content get to the right audiences. By enabling audience targeting, specific content will be prioritized to specific audiences through SharePoint web parts, page libraries, and navigational links. See <a href="https://support.microsoft.com/en-us/office/target-content-to-a-specific-audience-on-a-sharepoint-site-68113d1b-be99-4d4c-a61c-73b087f48a81">here</a> to learn more. In SharePoint Online audiences are equivalent to Groups in Azure AD, the &quot;classic&quot; audience system is not supported by PnP Core SDK. The guids shown on this page are id's of Azure AD groups.</p>
<p>In the remainder of this article you'll see a lot of <code>context</code> use: in this case this is a <code>PnPContext</code> which was obtained via the <code>PnPContextFactory</code> as explained in the <a href="readme.html">overview article</a> and show below:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // See next chapter on how to use the PnPContext for working with navigation
}
</code></pre>
<h2 id="in-navigation">In navigation</h2>
<p>Navigation nodes can have up to 10 audiences to have them show up for the right audiences. Before adding audiences to navigation nodes you first need to ensure that the site's navigation is configured for using audiences by setting the <code>NavAudienceTargetingEnabled</code> property to <code>true</code>.</p>
<pre><code class="lang-csharp">await context.Web.EnsurePropertiesAsync(w =&gt; w.NavAudienceTargetingEnabled);
context.Web.NavAudienceTargetingEnabled = true;
await context.Web.UpdateAsync();
</code></pre>
<p>Once the site has been configured you can add new navigation nodes with one or more audiences. Below sample adds a new node to the site's left (<code>QuickLaunch</code>) navigation, if the site uses a top (<code>TopNavigationBar</code>) navigation then the same approach applies.</p>
<pre><code class="lang-csharp">var node = await context.Web.Navigation.QuickLaunch.AddAsync(
                new NavigationNodeOptions
                {
                    Title = &quot;My node&quot;,
                    Url = &quot;/sites/demo/mylibrary&quot;,
                    AudienceIds = new List&lt;Guid&gt; { Guid.Parse(&quot;7bf72917-4c72-4a83-91d6-1362fcf7222a&quot;),  Guid.Parse(&quot;0402aa20-e67a-47e3-bad4-03801247be9e&quot;) }
                });
</code></pre>
<p>You can also update the set audiences:</p>
<pre><code class="lang-csharp">// Load the node to update
var node = await context.Web.Navigation.QuickLaunch.GetByIdAsync(1204);

// Update the node by adding an audience
node.AudienceIds = new System.Collections.Generic.List&lt;Guid&gt; { Guid.Parse(&quot;7bf72917-4c72-4a83-91d6-1362fcf7222a&quot;) };
await node.UpdateAsync();
</code></pre>
<p>Or remove the set audiences:</p>
<pre><code class="lang-csharp">// Load the node to update
var node = await context.Web.Navigation.QuickLaunch.GetByIdAsync(1204);

// Remove the audiences again
node.AudienceIds.Clear();
await node.UpdateAsync();
</code></pre>
<h2 id="for-files-and-list-items-in-libraries-and-lists">For files and list items in libraries and lists</h2>
<p>Some web parts (e.g. news web part, high lighted content web part, ...) do support audience targeting. This works by defining audiences on the content (pages, documents) shown by these web parts and to so you first need to enable audience targeting for the respective pages and document libraries by using one of the <code>EnableAudienceTargeting</code> methods. Once that's done you need to use the <code>EnsureUser</code> method to resolve an Azure AD Group id into a user and then update the <code>_ModernAudienceTargetUserField</code> list item field of your document or page.</p>
<pre><code class="lang-csharp">// Load library to update
var myList = await context.Web.Lists.GetByTitleAsync(&quot;MyLibrary&quot;, 
                                                    p =&gt; p.Title, 
                                                    p =&gt; p.RootFolder,
                                                    p =&gt; p.Fields.QueryProperties(p =&gt; p.InternalName,
                                                                                  p =&gt; p.FieldTypeKind,
                                                                                  p =&gt; p.TypeAsString,
                                                                                  p =&gt; p.Title));
// Enable audience targeting
await myList.EnableAudienceTargetingAsync();

// Upload file to library
IFile addedFile = await myList.RootFolder.Files.AddAsync(&quot;test.docx&quot;, System.IO.File.OpenRead($&quot;.{Path.DirectorySeparatorChar}test.docx&quot;));

// Resolve Azure AD Groups for use as audiences using a single roundtrip
var batch = context.NewBatch();
var myUser1 = await context.Web.EnsureUserBatchAsync(batch, &quot;c:0o.c|federateddirectoryclaimprovider|06ed1f73-c58d-45e8-ad07-66f4d1eed723&quot;);
var myUser2 = await context.Web.EnsureUserBatchAsync(batch, &quot;c:0o.c|federateddirectoryclaimprovider|7bf72917-4c72-4a83-91d6-1362fcf7222a&quot;);
var myUser3 = await context.Web.EnsureUserBatchAsync(batch, &quot;c:0o.c|federateddirectoryclaimprovider|0402aa20-e67a-47e3-bad4-03801247be9e&quot;);
await context.ExecuteAsync(batch);

// Load the file metadata first
await addedFile.LoadAsync(p =&gt; p.ListItemAllFields.QueryProperties(li =&gt; li.All));

// Set audiences for uploaded file
var userCollection = new FieldValueCollection();
userCollection.Values.Add(new FieldUserValue(myUser1));
userCollection.Values.Add(new FieldUserValue(myUser2));
userCollection.Values.Add(new FieldUserValue(myUser3));

addedFile.ListItemAllFields.Values.Add(&quot;_ModernAudienceTargetUserField&quot;, userCollection);
await addedFile.ListItemAllFields.UpdateAsync();

</code></pre>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>    
    <img src="https://m365-visitor-stats.azurewebsites.net/pnpcoresdk/docs">
  </body>
</html>