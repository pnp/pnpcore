<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Security | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Security | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/pnpcore/blob/dev/docs/using-the-sdk/admin-m365-security.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="security">Security</h1>

<p>The Core SDK Admin library provides Microsoft 365 Admin APIs for working with security like for example understanding if the current access token has certain permissions or uses for example application permissions.</p>
<h2 id="creating-context">Creating Context</h2>
<p>In this article, you'll see a lot of <code>context</code> use: in this case this is a <code>PnPContext</code> which was obtained via the <code>PnPContextFactory</code> as explained in the <a href="readme.html">overview article</a> and show below:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // See next chapter on how to use the PnPContext for doing Microsoft 365 admin operations
}
</code></pre>
<h2 id="pnpcoreadmin-dependency">PnP.Core.Admin dependency</h2>
<p>The functionality shown in this article depends on the <a href="https://www.nuget.org/packages/PnP.Core.Admin">PnP.Core.Admin nuget package</a>. Once the PnP.Core.Admin nuget package has been installed you can get to the Microsoft 365 admin features via using the <code>GetMicrosoft365Admin</code> extension method:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // Use the GetMicrosoft365Admin extension method on any PnPContext 
    // to tap into the Microsoft 365 admin features
    var isMultiGeo = await context.GetMicrosoft365Admin().IsMultiGeoTenantAsync();
}
</code></pre>
<h2 id="verify-if-youre-running-using-application-permissions">Verify if you're running using Application permissions</h2>
<p>If you're application supports application and delegated permissions you might want to know whether the current user/app is using application permissions. This can be checked via the <code>AccessTokenUsesApplicationPermissions</code> methods.</p>
<pre><code class="lang-csharp">if (await context.GetMicrosoft365Admin().AccessTokenUsesApplicationPermissionsAsync())
{
    // We're using application permissions
}
else
{
    // We're using delegated permissions
}
</code></pre>
<h2 id="verify-if-the-current-access-token-has-a-specific-scope-or-role">Verify if the current access token has a specific scope or role</h2>
<p>When using application permissions and access token contains one or more roles that identify the permissions granted to the app for which the access token was issued. Using the <code>AccessTokenHasRole</code> methods you can verify that.</p>
<div class="NOTE">
<h5>Note</h5>
<p>This method checks for the actual granted role, so if you check for <code>Sites.Read.All</code> and the token contains <code>Sites.Manage.All</code> then the check will return false.</p>
</div>
<p>Sample code:</p>
<pre><code class="lang-csharp">if (await context.GetMicrosoft365Admin().AccessTokenHasRoleAsync(&quot;Sites.Read.All&quot;))
{
    // We have the needed permissions, let's continue
}
else
{
    // Oops...
}
</code></pre>
<p>When using delegated permissions and access token contains one or more scopes that identify the permissions granted to the app+user for which the access token was issued. Using the <code>AccessTokenHasScope</code> methods you can verify that.</p>
<div class="NOTE">
<h5>Note</h5>
<p>This method checks for the actual granted role, so if you check for <code>Sites.Read.All</code> and the token contains <code>Sites.Manage.All</code> then the check will return false.</p>
</div>
<p>Sample code:</p>
<pre><code class="lang-csharp">if (await context.GetMicrosoft365Admin().AccessTokenHasScopeAsync(&quot;Sites.Read.All&quot;))
{
    // We have the needed permissions, let's continue
}
else
{
    // Oops...
}
</code></pre>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>    
    <!-- <img src="https://m365-visitor-stats.azurewebsites.net/pnpcoresdk/docs" /> -->
  </body>
</html>