<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html lang="en">
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Customizing Microsoft Viva Connections | PnP Core SDK </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Customizing Microsoft Viva Connections | PnP Core SDK ">
    <meta name="generator" content="docfx 2.59.2.0">
    <meta name="description" content="The PnP Core SDK is a modern .NET SDK designed to work for Microsoft 365. It provides a unified object model for working with SharePoint Online and Teams which is agnostic to the underlying API's being called.">
    <link rel="shortcut icon" href="https://c.s-microsoft.com/favicon.ico?v2">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet"> 
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    <meta property="docfx:rel" content="../">
    <meta property="docfx:newtab" content="true">
  </head>  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../images/logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <label class="glyphicon glyphicon-search" for="search-query"></label>
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div class="container body-content">
        
        <div id="search-results">
          <div class="search-list">Search Results for <span></span></div>
          <div class="sr-items">
            <p><i class="glyphicon glyphicon-refresh index-loading"></i></p>
          </div>
          <ul id="pagination" data-first="First" data-prev="Previous" data-next="Next" data-last="Last"></ul>
        </div>
      </div>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
                  <div class="contribution-panel mobile-hide pull-right">
                      <a href="https://github.com/pnp/pnpcore/blob/dev/docs/using-the-sdk/vivaconnections-intro.md/#L1" title="Improve this Doc" class="improve-doc-lg"><i class="glyphicon glyphicon-pencil"></i></a>
                  </div>
                    <h1 id="customizing-microsoft-viva-connections">Customizing Microsoft Viva Connections</h1>

<p>Microsoft Viva Connections is your gateway to a modern employee experience designed to keep everyone engaged and informed. Viva Connections gives everyone a personalized destination where you'll discover relevant news, conversations, and the tools they need to succeed. Checkout <a href="https://docs.microsoft.com/en-us/viva/connections/viva-connections-overview#:%7E:text=Viva%20Connections%20is%3A&amp;text=A%20gateway%20to%20employee%20experiences,Teams%2C%20Yammer%2C%20and%20Stream.">this article</a> to learn more.</p>
<p>In the remainder of this article you'll see a lot of <code>context</code> use: in this case this is a <code>PnPContext</code> which was obtained via the <code>PnPContextFactory</code> as explained in the <a href="readme.html">overview article</a> and show below:</p>
<pre><code class="lang-csharp">using (var context = await pnpContextFactory.CreateAsync(&quot;SiteToWorkWith&quot;))
{
    // See next chapter on how to use the PnPContext for adding, updating and deleting data
}
</code></pre>
<h2 id="discovering-the-tenant-home-site">Discovering the tenant home site</h2>
<p>Currently a Microsoft 365 tenant can have only one site marked as &quot;home site&quot;. This home site is important for Viva Connections as that Viva Connections dashboard is defined and managed from within that home site. To verify if the site collection you're using is a home site you can use one of the <code>IsHomeSite</code> methods on <code>ISite</code>:</p>
<pre><code class="lang-csharp"> if (await context.Site.IsHomeSiteAsync())
 {
     // Continue with customizing the Viva Connections dashboard
 }
</code></pre>
<h2 id="customizing-the-viva-connections-dashboard">Customizing the Viva Connections dashboard</h2>
<p>The Microsoft Viva Connections dashboard is the key component of the Microsoft Viva setup, the dashboard is comprised out of a set of adaptive card extensions (ACEs) which are added on a page. Similar to SharePoint pages there are a number of out of the box adaptive card extensions (e.g. the Card Designer ACE) and the option to build your own custom adaptive card extensions. If you want to built your own ACEs then check out the <a href="https://docs.microsoft.com/en-us/sharepoint/dev/spfx/viva/overview-viva-connections">developer documentation</a>.</p>
<h3 id="reading-the-dashboard">Reading the dashboard</h3>
<p>A Microsoft Viva Connections dashboard is represented via the <code>IVivaDashboard</code> interface in PnP Core SDK. After having loaded the dashboard you can add, update and remove ACEs from the dashboard and save the changes. You can also enumerate the currently added ACEs and inspect them. To read the Microsoft Viva Connections dashboard you will need to use one of the <code>GetVivaDashboard</code> methods on <code>IWeb</code>:</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

foreach(var ACE in dashboard.ACEs)
{
    // loop over the ACEs that were added to the dashboard
}
</code></pre>
<h3 id="adding-an-ace-to-the-dashboard-typed-approach">Adding an ACE to the dashboard: typed approach</h3>
<p>To add an ACE to the dashboard you first need to instantiate an <code>AdaptiveCardExtension</code> or a class inheriting from that one (e.g. <code>CardDesignerACE</code>, <code>AssignedTasksACE</code> or <code>TeamsACE</code>). When instantiating that class the constructor allows you to specify the ACE card size to use on the dashboard, default will be <code>CardSize.Medium</code>, but you can also choose <code>CardSize.Large</code>. When using the typed approach, which is available for some of the ACEs, you can build the ACE configuration in a typed manner as shown in the below sample. Once the ACE has been created and configured it can be added to the dashboard via an <code>AddACE</code> method and finally the dashboard changes are persisted via one of the <code>Save</code> methods.</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

var cardDesignerACE = new CardDesignerACE(CardSize.Large)
{
    Title = &quot;Test Card Designer ACE&quot;,
    Description = &quot;Test description&quot;,
    Properties = new CardDesignerProps
    {
        DataType = &quot;Static&quot;,
        TemplateType = &quot;primaryText&quot;,
        CardIconSourceType = 1,
        CardImageSourceType = 1,
        CardSelectionAction = new ExternalLinkAction
        {
            Parameters = new ExternalLinkActionParameter
            {
                Target = &quot;https://bing.com&quot;
            }
        },
        NumberCardButtonActions = 2,
        CardButtonActions = new List&lt;ButtonAction&gt;
        {
            new ButtonAction
            {
                Title = &quot;Test 1&quot;,
                Style = &quot;positive&quot;,
                Action = new ExternalLinkAction
                {
                    Parameters = new ExternalLinkActionParameter
                    {
                        Target = &quot;https://google.com&quot;
                    }
                }
            },
            new ButtonAction
            {
                Title = &quot;Test 2&quot;,
                Style = &quot;default&quot;,
                Action = new QuickViewAction
                {
                    Parameters = new QuickViewActionParameter
                    {
                        View = &quot;quickView&quot;
                    }
                }
            }
        },
        QuickViews = new List&lt;QuickView&gt;
        {
            new QuickView
            {
                Data = &quot;{\n  \&quot;Url\&quot;: \&quot;http://adaptivecards.io/schemas/adaptive-card.json\&quot;,\n  \&quot;Text\&quot;: \&quot;Hello, World!\&quot;\n}&quot;,
                Template = &quot;{\n  \&quot;type\&quot;: \&quot;AdaptiveCard\&quot;,\n  \&quot;body\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;TextBlock\&quot;,\n      \&quot;size\&quot;: \&quot;Medium\&quot;,\n      \&quot;weight\&quot;: \&quot;Bolder\&quot;,\n      \&quot;text\&quot;: \&quot;${Text}\&quot;,\n      \&quot;wrap\&quot;: true\n    }\n  ],\n  \&quot;actions\&quot;: [\n    {\n      \&quot;type\&quot;: \&quot;Action.OpenUrl\&quot;,\n      \&quot;title\&quot;: \&quot;View\&quot;,\n      \&quot;url\&quot;: \&quot;${Url}\&quot;\n    }\n  ],\n  \&quot;$schema\&quot;: \&quot;http://adaptivecards.io/schemas/adaptive-card.json\&quot;,\n  \&quot;version\&quot;: \&quot;1.2\&quot;\n}&quot;,
                Id = &quot;quickView&quot;,
                DisplayName = &quot;Test Quick View&quot;
            }
        },
        QuickViewConfigured = false,
        PrimaryText = &quot;Test heading&quot;,
        CustomImageSettings = new CustomImageSettings
        {
            Type = 1,
            AltText = &quot;There should be an image here&quot;,
            ImageUrl = &quot;https://cdn.hubblecontent.osi.office.net/m365content/publish/06faab94-9fb9-43b2-a274-9f0f51fedc3c/982488044.jpg&quot;
        }
    }
};

// Add the ACE to the dashboard on position 10
dashboard.AddACE(cardDesignerACE, 10);

// Persist the dashboard
await dashboard.SaveAsync();
</code></pre>
<h3 id="adding-an-ace-to-the-dashboard-untyped-approach">Adding an ACE to the dashboard: untyped approach</h3>
<p>Whereas above approach showed a typed way of configuring the ACE you can also use a generic approach. In the generic way you provide the ACE configuration as a JSON bloc. There are two possible options, both shown in below sample. In option B the ACE default settings are applied, so if you'd not set any specific properties you will end up with the default ACE configuration as like you would get when manually adding the ACE to the dashboard. When using option A you're required to also set the <code>Properties</code>.</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

// Instantiate the ACE: Option A
var cardDesignerACE = new AdaptiveCardExtension(CardSize.Large);
cardDesignerACE.Title = &quot;PnP Rocks!&quot;;
cardDesignerACE.Description = &quot;Text+image card. Text on second line. We can &quot;;
cardDesignerACE.Id = VivaDashboard.DefaultACEToId(DefaultACE.CardDesigner);

// Instantiate the ACE: Option B
var cardDesignerACE = dashboard.NewACE(DefaultACE.CardDesigner, CardSize.Large);

// Set the ACE properties
cardDesignerACE.Properties = JsonSerializer.Deserialize&lt;JsonElement&gt;(&quot;{\&quot;templateType\&quot;:\&quot;image\&quot;,\&quot;cardIconSourceType\&quot;:2,\&quot;cardImageSourceType\&quot;:1,\&quot;cardSelectionAction\&quot;:{\&quot;type\&quot;:\&quot;QuickView\&quot;,\&quot;parameters\&quot;:{\&quot;view\&quot;:\&quot;quickView\&quot;}},\&quot;numberCardButtonActions\&quot;:1,\&quot;cardButtonActions\&quot;:[{\&quot;title\&quot;:\&quot;Button\&quot;,\&quot;style\&quot;:\&quot;positive\&quot;,\&quot;action\&quot;:{\&quot;type\&quot;:\&quot;ExternalLink\&quot;,\&quot;parameters\&quot;:{\&quot;target\&quot;:\&quot;https://www.bing.com/\&quot;}}},{\&quot;title\&quot;:\&quot;Button\&quot;,\&quot;style\&quot;:\&quot;default\&quot;,\&quot;action\&quot;:{\&quot;type\&quot;:\&quot;QuickView\&quot;,\&quot;parameters\&quot;:{\&quot;view\&quot;:\&quot;quickView\&quot;}}}],\&quot;quickViews\&quot;:[{\&quot;data\&quot;:\&quot;\&quot;,\&quot;template\&quot;:\&quot;\&quot;,\&quot;id\&quot;:\&quot;quickView\&quot;,\&quot;displayName\&quot;:\&quot;Default Quick View\&quot;}],\&quot;isQuickViewConfigured\&quot;:true,\&quot;currentQuickViewIndex\&quot;:0,\&quot;dataType\&quot;:\&quot;Static\&quot;,\&quot;spRequestUrl\&quot;:\&quot;\&quot;,\&quot;requestUrl\&quot;:null,\&quot;graphRequestUrl\&quot;:\&quot;\&quot;,\&quot;primaryText\&quot;:\&quot;Text+image card. Text on second line. We can \&quot;,\&quot;cardIconCustomImageSettings\&quot;:null,\&quot;aceData\&quot;:{\&quot;cardSize\&quot;:null},\&quot;title\&quot;:\&quot;PnP rocks!\&quot;,\&quot;description\&quot;:\&quot;Description text\&quot;,\&quot;iconProperty\&quot;:\&quot;https://image.flaticon.com/icons/png/512/747/747055.png\&quot;,\&quot;cardImageCustomImageSettings\&quot;:{\&quot;type\&quot;:1,\&quot;altText\&quot;:\&quot;Image thumbnail preview\&quot;,\&quot;imageUrl\&quot;:\&quot;https://bertonline.sharepoint.com/SiteAssets/SitePages/newpage/40298-NewPerspective-newspost.jpg\&quot;},\&quot;imagePicker\&quot;:\&quot;https://bertonline.sharepoint.com/SiteAssets/SitePages/newpage/40298-NewPerspective-newspost.jpg\&quot;}&quot;);


// Add the ACE to the dashboard on position 10
dashboard.AddACE(cardDesignerACE, 10);

// Persist the dashboard
await dashboard.SaveAsync();
</code></pre>
<h3 id="adding-3rd-party-aces-to-the-dashboard">Adding 3rd party ACEs to the dashboard</h3>
<p>The techniques shown to add out of the box ACEs also apply to 3rd party ACEs, although there are minor differences in the initial instantiation.</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

// Instantiate the ACE: Option A
var customACE = new AdaptiveCardExtension();
cardDesignerACE.Title = &quot;Custom Async ACE&quot;;
cardDesignerACE.Description = &quot;something&quot;;
cardDesignerACE.Id = &quot;9e73ef29-1b62-4084-92b5-207bedea22b8&quot;;

// Instantiate the ACE: Option B
var customACE = dashboard.NewACE(new Guid(&quot;9e73ef29-1b62-4084-92b5-207bedea22b8&quot;));
customACE.Title = &quot;Custom Async ACE&quot;;
customACE.Description = &quot;something&quot;;

// Set the ACE properties
customACE.Properties = JsonSerializer.Deserialize&lt;JsonElement&gt;(&quot;{...}&quot;);

// Add the ACE to the dashboard as first ACE
dashboard.AddACE(customACE);

// Persist the dashboard
await dashboard.SaveAsync();
</code></pre>
<h3 id="removing-an-ace-from-the-dashboard">Removing an ACE from the dashboard</h3>
<p>To remove an ACE from a dashboard simply use the <code>RemoveACE</code> method providing the ACE instance id as key and then save the dashboard again.</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

// Get the first card designer ACE
var firstCardDesignerACE = dashboard.ACEs.FirstOrDefault(p =&gt; p.ACEType == DefaultACE.CardDesigner)

// Remove the ACE from the dashboard
dashboard.RemoveACE(firstCardDesignerACE.InstanceId);

// Persist the dashboard
await dashboard.SaveAsync();
</code></pre>
<h3 id="updating-an-ace">Updating an ACE</h3>
<p>You can also update existing ACEs by using the <code>UpdateACE</code> method followed by saving the dashboard changes again. When updating an ACE you need to specify the updated <code>AdaptiveCardExtension</code> instance:</p>
<pre><code class="lang-csharp">IVivaDashboard dashboard = await context.Web.GetVivaDashboardAsync();

// Get the first card designer ACE
var firstCardDesignerACE = dashboard.ACEs.FirstOrDefault(p =&gt; p.ACEType == DefaultACE.CardDesigner)

// Update the ACE
firstCardDesignerACE.Title = &quot;Updated title&quot;;
firstCardDesignerACE.CardSize = CardSize.Medium;

// Update the ACE, but also move it to be the last card on the dashboard
dashboard.UpdateACE(firstCardDesignerACE, 500);

// Persist the dashboard
await dashboard.SaveAsync();
</code></pre>
<h3 id="using-a-typed-approach-for-your-own-3rd-party-aces">Using a typed approach for your own 3rd party ACEs</h3>
<p>If you whish, you can extend the typed support like there is for some of the 1st party ACEs to your own 3rd party ACEs by implementing the <code>AdaptiveCardExtension</code>, <code>ACEProperties</code> and <code>ACEFactory</code> classes:</p>
<pre><code class="lang-csharp">internal class CustomAsyncCard : AdaptiveCardExtension&lt;CustomAsyncCardProps&gt;
{
    public CustomAsyncCard()
    {
        Id = &quot;9e73ef29-1b62-4084-92b5-207bedea22b8&quot;;
        Title = &quot;Async Card&quot;;
    }
}

internal class CustomAsyncCardProps : ACEProperties
{
    [JsonPropertyName(&quot;myProp&quot;)]
    public string MyACEProp { get; set; } = &quot;default value&quot;;
}

internal class CustomAsyncCardFactory : ACEFactory
{
    public override string ACEId =&gt; &quot;9e73ef29-1b62-4084-92b5-207bedea22b8&quot;;

    public override AdaptiveCardExtension BuildACEFromWebPart(IPageWebPart control)
    {
        return new CustomAsyncCard()
        {
            Id = control.WebPartId,
            Description = control.Description,
            InstanceId = control.InstanceId,
            Title = control.Title,
            Properties = JsonSerializer.Deserialize&lt;CustomAsyncCardProps&gt;(control.PropertiesJson)
        };
    }
}
</code></pre>
<p>Once you've implementing the typed model for your ACE you need to register your custom ACE factory with the dashboard so when reading a dashboard you ACE properties are loaded into the typed model you've defined:</p>
<pre><code class="lang-csharp">// Load the dashboard again
dashboard = context.Web.GetVivaDashboard();

// Register custom ACE factory
dashboard.RegisterCustomACEFactory(new CustomAsyncCardFactory());
</code></pre>
</article>
          </div>
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              </nav>
            </div>
          </div>        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            <span>PnP Core SDK<br>Generated by <strong><a href='https://dotnet.github.io/docfx' alt='Doc FX Website'>DocFX</a></strong> with <strong><a href='https://ovasquez.github.io/docfx-material' alt='DocFx Material Theme'>Material UI</a></strong></span>
            
            <img src="https://telemetry.sharepointpnp.com/@pnp.github.io/index/" alt="spacer">
          </div>
        </div>
      </footer>    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>    
    <img src="https://m365-visitor-stats.azurewebsites.net/pnpcoresdk/docs">
  </body>
</html>